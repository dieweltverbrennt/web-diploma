{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted } from 'vue';\nimport apiRequest from '@/axios.js';\nimport { useRoute } from 'vue-router';\nexport default {\n  __name: 'HallPage',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const route = useRoute();\n    const sessionId = route.params.sessionId;\n    const session = ref({});\n    const film = ref({});\n    const hall = ref({});\n    const selectedChairs = ref([]);\n    onMounted(async () => {\n      try {\n        const response = await apiRequest.get(`/sessions/${sessionId}`);\n        session.value = response.data.session;\n        film.value = response.data.session.film;\n        hall.value = response.data.session.hall;\n        session.value.start_time = session.value.start_time.split(':').slice(0, 2).join(':');\n      } catch (error) {\n        console.error('Ошибка при получении данных:', error);\n      }\n    });\n    const chairType = (i, j) => {\n      let current = hall.value.seats.find(item => item.row_number === i && item.seat_number === j);\n      if (current.is_free !== 1) {\n        return 'buying-scheme__chair buying-scheme__chair_taken';\n      } else {\n        if (selectedChairs.value.includes(current.id)) {\n          return `buying-scheme__chair buying-scheme__chair_selected`;\n        }\n        return `buying-scheme__chair buying-scheme__chair_${current.type}`;\n      }\n    };\n    const onSelectChair = (i, j) => {\n      let current = hall.value.seats.find(item => item.row_number === i && item.seat_number === j);\n      const index = selectedChairs.value.indexOf(current.id);\n      if (selectedChairs.value.includes(current.id)) {\n        selectedChairs.value = selectedChairs.value.filter(item => item !== current.id);\n      } else {\n        selectedChairs.value.push(current.id);\n      }\n      chairType(i, j);\n    };\n    const onReserveClick = async () => {\n      console.log('click');\n      try {\n        const response = await apiRequest.post('/seats/' + selectedChairs.value.join(','), {\n          _method: 'PUT' // Имитация метода PUT через POST\n        });\n        if (response.data.success) {\n          this.$router.push({\n            name: 'payment-success'\n          });\n        }\n      } catch (error) {\n        console.error('Ошибка при бронировании:', error);\n      }\n    };\n    const __returned__ = {\n      route,\n      sessionId,\n      session,\n      film,\n      hall,\n      selectedChairs,\n      chairType,\n      onSelectChair,\n      onReserveClick,\n      ref,\n      onMounted,\n      get apiRequest() {\n        return apiRequest;\n      },\n      get useRoute() {\n        return useRoute;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","apiRequest","useRoute","route","sessionId","params","session","film","hall","selectedChairs","response","get","value","data","start_time","split","slice","join","error","console","chairType","i","j","current","seats","find","item","row_number","seat_number","is_free","includes","id","type","onSelectChair","index","indexOf","filter","push","onReserveClick","log","post","_method","success","$router","name"],"sources":["C:/Users/Marya/Desktop/cinema-booking-app/client/src/components/client/HallPage.vue"],"sourcesContent":["<template>\r\n    <main>\r\n    <section class=\"buying\">\r\n      <div class=\"buying__info\">\r\n        <div class=\"buying__info-description\">\r\n          <h2 class=\"buying__info-title\">{{ film.name }}</h2>\r\n          <p class=\"buying__info-start\">Начало сеанса: {{ session.start_time }}</p>\r\n          <p class=\"buying__info-hall\">Зал {{ hall.hall_number }}</p>          \r\n        </div>\r\n        <div class=\"buying__info-hint\">\r\n          <p>Тапните дважды,<br>чтобы увеличить</p>\r\n        </div>\r\n      </div>\r\n      <div class=\"buying-scheme\">\r\n        <div class=\"buying-scheme__wrapper\">\r\n            <div class=\"buying-scheme__row\"\r\n                v-for=\"i in hall.rows_count\"\r\n                :key=\"i\"\r\n            >\r\n                <span\r\n                    :class=\"chairType(i, j)\"\r\n                    v-for=\"j in hall.seats_in_row_count\"\r\n                    :key=\"j\"\r\n                    @click=\"onSelectChair(i, j)\"\r\n                ></span>\r\n            </div>  \r\n        </div>\r\n        <div class=\"buying-scheme__legend\">\r\n          <div class=\"col\">\r\n            <p class=\"buying-scheme__legend-price\"><span class=\"buying-scheme__chair buying-scheme__chair_standart\"></span> Свободно (<span class=\"buying-scheme__legend-value\">250</span>руб)</p>\r\n            <p class=\"buying-scheme__legend-price\"><span class=\"buying-scheme__chair buying-scheme__chair_vip\"></span> Свободно VIP (<span class=\"buying-scheme__legend-value\">350</span>руб)</p>            \r\n          </div>\r\n          <div class=\"col\">\r\n            <p class=\"buying-scheme__legend-price\"><span class=\"buying-scheme__chair buying-scheme__chair_taken\"></span> Занято</p>\r\n            <p class=\"buying-scheme__legend-price\"><span class=\"buying-scheme__chair buying-scheme__chair_selected\"></span> Выбрано</p>                    \r\n          </div>\r\n        </div>\r\n      </div>\r\n      <button class=\"acceptin-button\" @click=\"onReserveClick\" >Забронировать</button>\r\n    </section>     \r\n  </main>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue';\r\nimport apiRequest from '@/axios.js';\r\nimport { useRoute } from 'vue-router';\r\n\r\nconst route = useRoute();\r\nconst sessionId = route.params.sessionId;\r\n\r\nconst session = ref({});\r\nconst film = ref({});\r\nconst hall = ref({});\r\nconst selectedChairs = ref([]);\r\n\r\nonMounted(async () => {\r\n    try {\r\n        const response = await apiRequest.get(`/sessions/${sessionId}`);\r\n        session.value = response.data.session;\r\n        film.value = response.data.session.film;\r\n        hall.value = response.data.session.hall;\r\n        session.value.start_time = session.value.start_time.split(':').slice(0, 2).join(':')\r\n    } catch (error) {\r\n        console.error('Ошибка при получении данных:', error);\r\n    }\r\n});\r\n\r\nconst chairType = ((i, j) => {\r\n    let current = hall.value.seats.find(item => item.row_number === i && item.seat_number === j)\r\n    if (current.is_free !== 1) {\r\n        return 'buying-scheme__chair buying-scheme__chair_taken' \r\n    } else {\r\n        if (selectedChairs.value.includes(current.id)) {\r\n            return `buying-scheme__chair buying-scheme__chair_selected`\r\n        }\r\n        return `buying-scheme__chair buying-scheme__chair_${current.type}`\r\n    }\r\n});\r\n\r\nconst onSelectChair = ((i, j) => {\r\n    let current = hall.value.seats.find(item => item.row_number === i && item.seat_number === j);\r\n    const index = selectedChairs.value.indexOf(current.id);\r\n    if(selectedChairs.value.includes(current.id)) {\r\n            selectedChairs.value = selectedChairs.value.filter(item => item !== current.id);\r\n    } else {\r\n        selectedChairs.value.push(current.id);\r\n    }\r\n    chairType(i, j);\r\n});\r\n\r\nconst onReserveClick = (async () => {\r\n    console.log('click');\r\n    try {\r\n        const response = await apiRequest.post('/seats/' + selectedChairs.value.join(','), {\r\n        _method: 'PUT', // Имитация метода PUT через POST\r\n      })\r\n        if (response.data.success) {\r\n          this.$router.push({ name: 'payment-success' });\r\n        }\r\n    } catch (error) {\r\n        console.error('Ошибка при бронировании:', error);\r\n    }\r\n});\r\n</script>"],"mappings":";AA4CA,SAASA,GAAG,EAAEC,SAAS,QAAQ,KAAK;AACpC,OAAOC,UAAU,MAAM,YAAY;AACnC,SAASC,QAAQ,QAAQ,YAAY;;;;;;;IAErC,MAAMC,KAAK,GAAGD,QAAQ,CAAC,CAAC;IACxB,MAAME,SAAS,GAAGD,KAAK,CAACE,MAAM,CAACD,SAAS;IAExC,MAAME,OAAO,GAAGP,GAAG,CAAC,CAAC,CAAC,CAAC;IACvB,MAAMQ,IAAI,GAAGR,GAAG,CAAC,CAAC,CAAC,CAAC;IACpB,MAAMS,IAAI,GAAGT,GAAG,CAAC,CAAC,CAAC,CAAC;IACpB,MAAMU,cAAc,GAAGV,GAAG,CAAC,EAAE,CAAC;IAE9BC,SAAS,CAAC,YAAY;MAClB,IAAI;QACA,MAAMU,QAAQ,GAAG,MAAMT,UAAU,CAACU,GAAG,CAAE,aAAYP,SAAU,EAAC,CAAC;QAC/DE,OAAO,CAACM,KAAK,GAAGF,QAAQ,CAACG,IAAI,CAACP,OAAO;QACrCC,IAAI,CAACK,KAAK,GAAGF,QAAQ,CAACG,IAAI,CAACP,OAAO,CAACC,IAAI;QACvCC,IAAI,CAACI,KAAK,GAAGF,QAAQ,CAACG,IAAI,CAACP,OAAO,CAACE,IAAI;QACvCF,OAAO,CAACM,KAAK,CAACE,UAAU,GAAGR,OAAO,CAACM,KAAK,CAACE,UAAU,CAACC,KAAK,CAAC,GAAG,CAAC,CAACC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;MACxF,CAAC,CAAC,OAAOC,KAAK,EAAE;QACZC,OAAO,CAACD,KAAK,CAAC,8BAA8B,EAAEA,KAAK,CAAC;MACxD;IACJ,CAAC,CAAC;IAEF,MAAME,SAAS,GAAIA,CAACC,CAAC,EAAEC,CAAC,KAAK;MACzB,IAAIC,OAAO,GAAGf,IAAI,CAACI,KAAK,CAACY,KAAK,CAACC,IAAI,CAACC,IAAI,IAAIA,IAAI,CAACC,UAAU,KAAKN,CAAC,IAAIK,IAAI,CAACE,WAAW,KAAKN,CAAC,CAAC;MAC5F,IAAIC,OAAO,CAACM,OAAO,KAAK,CAAC,EAAE;QACvB,OAAO,iDAAiD;MAC5D,CAAC,MAAM;QACH,IAAIpB,cAAc,CAACG,KAAK,CAACkB,QAAQ,CAACP,OAAO,CAACQ,EAAE,CAAC,EAAE;UAC3C,OAAQ,oDAAmD;QAC/D;QACA,OAAQ,6CAA4CR,OAAO,CAACS,IAAK,EAAC;MACtE;IACJ,CAAE;IAEF,MAAMC,aAAa,GAAIA,CAACZ,CAAC,EAAEC,CAAC,KAAK;MAC7B,IAAIC,OAAO,GAAGf,IAAI,CAACI,KAAK,CAACY,KAAK,CAACC,IAAI,CAACC,IAAI,IAAIA,IAAI,CAACC,UAAU,KAAKN,CAAC,IAAIK,IAAI,CAACE,WAAW,KAAKN,CAAC,CAAC;MAC5F,MAAMY,KAAK,GAAGzB,cAAc,CAACG,KAAK,CAACuB,OAAO,CAACZ,OAAO,CAACQ,EAAE,CAAC;MACtD,IAAGtB,cAAc,CAACG,KAAK,CAACkB,QAAQ,CAACP,OAAO,CAACQ,EAAE,CAAC,EAAE;QACtCtB,cAAc,CAACG,KAAK,GAAGH,cAAc,CAACG,KAAK,CAACwB,MAAM,CAACV,IAAI,IAAIA,IAAI,KAAKH,OAAO,CAACQ,EAAE,CAAC;MACvF,CAAC,MAAM;QACHtB,cAAc,CAACG,KAAK,CAACyB,IAAI,CAACd,OAAO,CAACQ,EAAE,CAAC;MACzC;MACAX,SAAS,CAACC,CAAC,EAAEC,CAAC,CAAC;IACnB,CAAE;IAEF,MAAMgB,cAAc,GAAI,MAAAA,CAAA,KAAY;MAChCnB,OAAO,CAACoB,GAAG,CAAC,OAAO,CAAC;MACpB,IAAI;QACA,MAAM7B,QAAQ,GAAG,MAAMT,UAAU,CAACuC,IAAI,CAAC,SAAS,GAAG/B,cAAc,CAACG,KAAK,CAACK,IAAI,CAAC,GAAG,CAAC,EAAE;UACnFwB,OAAO,EAAE,KAAK,CAAE;QAClB,CAAC,CAAC;QACA,IAAI/B,QAAQ,CAACG,IAAI,CAAC6B,OAAO,EAAE;UACzB,IAAI,CAACC,OAAO,CAACN,IAAI,CAAC;YAAEO,IAAI,EAAE;UAAkB,CAAC,CAAC;QAChD;MACJ,CAAC,CAAC,OAAO1B,KAAK,EAAE;QACZC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;MACpD;IACJ,CAAE"},"metadata":{},"sourceType":"module","externalDependencies":[]}